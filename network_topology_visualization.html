<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Topology & Infrastructure Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1900px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #1e3c72;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: #1e3c72;
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1e3c72;
        }
        
        #topology-canvas {
            width: 100%;
            height: 900px;
            background: #f8f9fa;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        #topology-canvas:hover {
            cursor: crosshair;
        }
        
        .canvas-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            white-space: nowrap;
        }
        
        .topology-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-button {
            background: #1e3c72;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .control-button:hover {
            background: #2a5298;
            transform: translateY(-1px);
        }
        
        .control-button.active {
            background: #4CAF50;
        }
        
        .control-button.paused {
            background: #ff9800;
            animation: pulse-warning 2s infinite;
        }
        
        .control-button.paused:hover {
            background: #ff5722;
        }
        
        @keyframes pulse-warning {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(255, 152, 0, 0); }
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        
        .legend-icon {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }
        
        .legend-icon.host {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .legend-icon.nic {
            background: #2196F3;
            color: white;
        }
        
        .legend-icon.switch {
            background: #ff9800;
            color: white;
        }
        
        .legend-icon.container {
            background: #00bcd4;
            color: white;
        }
        
        .legend-icon.status-up {
            background: #4CAF50;
        }
        
        .legend-icon.status-down {
            background: #f44336;
        }
        
        .detail-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 350px;
            max-height: 700px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            padding: 15px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }
        
        .detail-panel.visible {
            display: block;
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1e3c72;
        }
        
        .detail-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .detail-close {
            cursor: pointer;
            font-size: 1.5em;
            color: #999;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .detail-close:hover {
            background: #f44336;
            color: white;
        }
        
        .detail-section {
            margin-bottom: 15px;
        }
        
        .detail-section-title {
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }
        
        .detail-label {
            color: #666;
        }
        
        .detail-value {
            font-weight: 600;
            color: #333;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .status-badge.up {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.down {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-badge.running {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-badge.stopped {
            background: #f8d7da;
            color: #721c24;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        th {
            background: #1e3c72;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåê Network Topology & Infrastructure Visualization</h1>
            <p style="color: #666; margin-top: 10px;">
                Interactive view of hosts, NICs, switches, and docker containers with real-time status
                <span id="pausedIndicator" style="display: none; margin-left: 15px; color: #ff9800; font-weight: bold;">‚è∏ AUTO-REFRESH PAUSED</span>
            </p>
        </header>
        
        <!-- Statistics Overview -->
        <div class="grid">
            <div class="stat-card">
                <div class="stat-value" id="hostCount">0</div>
                <div class="stat-label">Host Systems</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="nicCount">0</div>
                <div class="stat-label">Network Interfaces</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="switchCount">0</div>
                <div class="stat-label">Switches</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="containerCount">0</div>
                <div class="stat-label">Docker Containers</div>
            </div>
        </div>
        
        <!-- Topology Visualization -->
        <div class="card">
            <h2>üîÄ Interactive Network Topology</h2>
            <div class="topology-controls">
                <button class="control-button" onclick="togglePause()" id="pauseButton">
                    ‚è∏ Pause Auto-Refresh
                </button>
                <button class="control-button active" onclick="setView('topology')" id="view-topology">
                    Topology View
                </button>
                <button class="control-button" onclick="setView('hierarchy')" id="view-hierarchy">
                    Hierarchy View
                </button>
                <button class="control-button" onclick="toggleLabels()">
                    Toggle Labels
                </button>
                <button class="control-button" onclick="toggleConnectionLabels()">
                    Show Connection Info
                </button>
                <button class="control-button" onclick="resetZoom()">
                    Reset View
                </button>
                <button class="control-button" onclick="zoomIn()">
                    Zoom In +
                </button>
                <button class="control-button" onclick="zoomOut()">
                    Zoom Out -
                </button>
                <button class="control-button" onclick="exportTopology()">
                    Export PNG
                </button>
            </div>
            
            <canvas id="topology-canvas"></canvas>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-icon host">üñ•Ô∏è</div>
                    <span>Host System</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon nic">üîå</div>
                    <span>Network Interface</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon switch">üîÄ</div>
                    <span>Switch</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon container">üê≥</div>
                    <span>Docker Container</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon status-up"></div>
                    <span>Active/Running</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon status-down"></div>
                    <span>Inactive/Stopped</span>
                </div>
            </div>
            
            <!-- Detail Panel -->
            <div class="detail-panel" id="detailPanel">
                <div class="detail-header">
                    <div class="detail-title" id="detailTitle">Details</div>
                    <div class="detail-close" onclick="closeDetailPanel()">√ó</div>
                </div>
                <div id="detailContent"></div>
            </div>
        </div>
        
        <!-- Host Systems Details -->
        <div class="card">
            <h2>üñ•Ô∏è Host Systems & Docker Containers</h2>
            <table>
                <thead>
                    <tr>
                        <th>Host System</th>
                        <th>IP Address</th>
                        <th>NICs</th>
                        <th>Containers</th>
                        <th>Container Status</th>
                        <th>CPU %</th>
                        <th>Memory Usage</th>
                    </tr>
                </thead>
                <tbody id="hostTable">
                    <tr><td colspan="7" style="text-align: center;">Loading host data...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- NIC to Switch Mapping -->
        <div class="card">
            <h2>üîå NIC to Switch Connection Mapping</h2>
            <table>
                <thead>
                    <tr>
                        <th>NIC</th>
                        <th>Host</th>
                        <th>IP Address</th>
                        <th>Status</th>
                        <th>Connected to Switch</th>
                        <th>Switch Port</th>
                        <th>Containers Using</th>
                    </tr>
                </thead>
                <tbody id="nicMappingTable">
                    <tr><td colspan="7" style="text-align: center;">Loading NIC mapping...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- Docker Container Details -->
        <div class="card">
            <h2>üê≥ Docker Container Infrastructure</h2>
            <table>
                <thead>
                    <tr>
                        <th>Container Name</th>
                        <th>Host System</th>
                        <th>Status</th>
                        <th>Image</th>
                        <th>Ports</th>
                        <th>Network Mode</th>
                        <th>CPU %</th>
                        <th>Memory</th>
                    </tr>
                </thead>
                <tbody id="containerTable">
                    <tr><td colspan="8" style="text-align: center;">Loading container data...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // Canvas setup
        const canvas = document.getElementById('topology-canvas');
        const ctx = canvas.getContext('2d');
        let currentView = 'topology';
        let showLabels = true;
        let showConnectionLabels = false;
        let selectedNode = null;
        let zoomLevel = 1.0;
        let panX = 0;
        let panY = 0;
        let isPaused = false;
        let autoRefreshInterval = null;
        
        // Mock data - replace with real queries from docker_insight, node_insight, nic_info, switch tables
        function generateMockData() {
            // This simulates data from docker_insight table
            const dockerInsightData = [
                {
                    container_id: '1a2b3c4d',
                    container_name: 'anylog-operator',
                    host_name: 'AnyLog-Node-253',
                    host_ip: '172.79.89.2',
                    status: 'running',
                    image: 'anylogco/anylog-network:latest',
                    created: '2026-01-15T08:30:00Z',
                    started: '2026-01-15T08:30:15Z',
                    ports: '32148:32148/tcp, 32149:32149/tcp, 32348:32348/tcp',
                    network_mode: 'bridge',
                    cpu_percent: 8.2,
                    memory_usage: '1.2GB',
                    memory_limit: '4GB',
                    memory_percent: 30,
                    block_read: '125MB',
                    block_write: '89MB',
                    network_rx: '1.2GB',
                    network_tx: '890MB',
                    pids: 45,
                    uptime: '25 days',
                    restart_count: 0,
                    health_status: 'healthy'
                },
                {
                    container_id: '2b3c4d5e',
                    container_name: 'anylog-query',
                    host_name: 'AnyLog-Node-253',
                    host_ip: '172.79.89.2',
                    status: 'running',
                    image: 'anylogco/anylog-network:latest',
                    created: '2026-01-15T08:31:00Z',
                    started: '2026-01-15T08:31:10Z',
                    ports: '32248:32248/tcp, 32249:32249/tcp',
                    network_mode: 'bridge',
                    cpu_percent: 3.5,
                    memory_usage: '800MB',
                    memory_limit: '2GB',
                    memory_percent: 40,
                    block_read: '45MB',
                    block_write: '28MB',
                    network_rx: '450MB',
                    network_tx: '320MB',
                    pids: 32,
                    uptime: '25 days',
                    restart_count: 0,
                    health_status: 'healthy'
                },
                {
                    container_id: '3c4d5e6f',
                    container_name: 'nginx-proxy',
                    host_name: 'AnyLog-Node-253',
                    host_ip: '172.79.89.2',
                    status: 'running',
                    image: 'nginx:1.25-alpine',
                    created: '2026-01-15T08:29:00Z',
                    started: '2026-01-15T08:29:05Z',
                    ports: '80:80/tcp, 443:443/tcp',
                    network_mode: 'host',
                    cpu_percent: 1.2,
                    memory_usage: '45MB',
                    memory_limit: '512MB',
                    memory_percent: 8.8,
                    block_read: '12MB',
                    block_write: '8MB',
                    network_rx: '2.1GB',
                    network_tx: '5.6GB',
                    pids: 5,
                    uptime: '25 days',
                    restart_count: 0,
                    health_status: 'healthy'
                },
                {
                    container_id: '4d5e6f7g',
                    container_name: 'anylog-operator',
                    host_name: 'AnyLog-Node-201',
                    host_ip: '172.79.89.201',
                    status: 'running',
                    image: 'anylogco/anylog-network:latest',
                    created: '2026-01-15T08:30:00Z',
                    started: '2026-01-15T08:30:20Z',
                    ports: '32148:32148/tcp, 32149:32149/tcp',
                    network_mode: 'bridge',
                    cpu_percent: 15.8,
                    memory_usage: '2.1GB',
                    memory_limit: '8GB',
                    memory_percent: 26.3,
                    block_read: '2.4GB',
                    block_write: '1.8GB',
                    network_rx: '12GB',
                    network_tx: '8.5GB',
                    pids: 67,
                    uptime: '25 days',
                    restart_count: 1,
                    health_status: 'healthy'
                },
                {
                    container_id: '5e6f7g8h',
                    container_name: 'postgres-db',
                    host_name: 'AnyLog-Node-201',
                    host_ip: '172.79.89.201',
                    status: 'running',
                    image: 'postgres:14.10-alpine',
                    created: '2026-01-15T08:28:00Z',
                    started: '2026-01-15T08:28:30Z',
                    ports: '5432:5432/tcp',
                    network_mode: 'bridge',
                    cpu_percent: 22.3,
                    memory_usage: '4.5GB',
                    memory_limit: '16GB',
                    memory_percent: 28.1,
                    block_read: '45GB',
                    block_write: '38GB',
                    network_rx: '8.2GB',
                    network_tx: '12.4GB',
                    pids: 89,
                    uptime: '25 days',
                    restart_count: 0,
                    health_status: 'healthy'
                },
                {
                    container_id: '6f7g8h9i',
                    container_name: 'anylog-operator',
                    host_name: 'AnyLog-Node-202',
                    host_ip: '172.79.89.202',
                    status: 'running',
                    image: 'anylogco/anylog-network:latest',
                    created: '2026-01-15T08:30:00Z',
                    started: '2026-01-15T08:30:25Z',
                    ports: '32148:32148/tcp, 32149:32149/tcp',
                    network_mode: 'bridge',
                    cpu_percent: 45.2,
                    memory_usage: '3.8GB',
                    memory_limit: '8GB',
                    memory_percent: 47.5,
                    block_read: '5.6GB',
                    block_write: '4.2GB',
                    network_rx: '18GB',
                    network_tx: '14GB',
                    pids: 92,
                    uptime: '25 days',
                    restart_count: 2,
                    health_status: 'degraded'
                },
                {
                    container_id: '7g8h9i0j',
                    container_name: 'grafana',
                    host_name: 'AnyLog-Node-201',
                    host_ip: '172.79.89.201',
                    status: 'running',
                    image: 'grafana/grafana:latest',
                    created: '2026-01-20T10:15:00Z',
                    started: '2026-01-20T10:15:20Z',
                    ports: '3000:3000/tcp',
                    network_mode: 'bridge',
                    cpu_percent: 2.8,
                    memory_usage: '320MB',
                    memory_limit: '1GB',
                    memory_percent: 32,
                    block_read: '180MB',
                    block_write: '95MB',
                    network_rx: '1.4GB',
                    network_tx: '3.2GB',
                    pids: 28,
                    uptime: '20 days',
                    restart_count: 0,
                    health_status: 'healthy'
                }
            ];
            
            // Aggregate by host
            const hosts = {};
            dockerInsightData.forEach(container => {
                if (!hosts[container.host_name]) {
                    hosts[container.host_name] = {
                        id: container.host_name.toLowerCase().replace(/[^a-z0-9]/g, ''),
                        name: container.host_name,
                        ip: container.host_ip,
                        nics: [],
                        containers: [],
                        cpu: 0,
                        memory: '',
                        total_containers: 0,
                        running_containers: 0
                    };
                }
                hosts[container.host_name].containers.push(container.container_name);
                hosts[container.host_name].total_containers++;
                if (container.status === 'running') {
                    hosts[container.host_name].running_containers++;
                }
            });
            
            // Add NIC data (from nic_info table)
            const nicData = [
                { name: 'eno1', host: 'AnyLog-Node-253', ip: '172.79.89.2', mac: '00:1a:2b:3c:4d:5e', status: 'up', speed: '1000Mbps', switch: 'Switch 2', port: 1 },
                { name: 'enp2s0', host: 'AnyLog-Node-253', ip: '192.168.200.2', mac: '00:1a:2b:3c:4d:5f', status: 'up', speed: '1000Mbps', switch: 'Switch 3', port: 3 },
                { name: 'enp5s0', host: 'AnyLog-Node-253', ip: null, mac: '00:1a:2b:3c:4d:60', status: 'down', speed: null, switch: null, port: null },
                { name: 'eno1', host: 'AnyLog-Node-201', ip: '172.79.89.201', mac: '00:1a:2b:3c:4d:61', status: 'up', speed: '1000Mbps', switch: 'Switch 2', port: 2 },
                { name: 'enp1s0', host: 'AnyLog-Node-201', ip: '10.0.1.201', mac: '00:1a:2b:3c:4d:62', status: 'up', speed: '1000Mbps', switch: 'Switch 4', port: 5 },
                { name: 'eno1', host: 'AnyLog-Node-202', ip: '172.79.89.202', mac: '00:1a:2b:3c:4d:63', status: 'up', speed: '1000Mbps', switch: 'Switch 2', port: 4 }
            ];
            
            // Map NICs to containers
            nicData.forEach(nic => {
                const containersOnNic = dockerInsightData
                    .filter(c => c.host_name === nic.host && c.network_mode === 'bridge')
                    .map(c => c.container_name);
                nic.containers = containersOnNic;
                
                if (hosts[nic.host]) {
                    hosts[nic.host].nics.push(nic.name);
                }
            });
            
            // Add host system metrics (from node_insight)
            hosts['AnyLog-Node-253'].cpu = 15.3;
            hosts['AnyLog-Node-253'].memory = '8.5GB / 16GB';
            hosts['AnyLog-Node-201'].cpu = 42.1;
            hosts['AnyLog-Node-201'].memory = '12.2GB / 32GB';
            hosts['AnyLog-Node-202'].cpu = 87.3;
            hosts['AnyLog-Node-202'].memory = '28.4GB / 32GB';
            
            // Switch data (from switch table)
            const switches = [
                { name: 'Switch 2', ip: '172.79.89.10', model: 'ETH2-DN0802XXD1-01G', ports: 8, connected: true, activeports: 3 },
                { name: 'Switch 3', ip: '172.79.89.20', model: 'ETH2-DN0802XXD1-01G', ports: 8, connected: true, activeports: 1 },
                { name: 'Switch 4', ip: '172.79.89.30', model: 'ETH2-DN1604XXD1-01G', ports: 16, connected: false, activeports: 0 },
                { name: 'Switch 5', ip: '172.79.89.40', model: 'ETH2-1U082404D1-10G', ports: 24, connected: true, activeports: 0 }
            ];
            
            return {
                hosts: Object.values(hosts),
                nics: nicData,
                switches: switches,
                containers: dockerInsightData
            };
        }
        
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = 900;
        }
        
        function drawTopology(data) {
            resizeCanvas();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Apply zoom and pan transformations
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.scale(zoomLevel, zoomLevel);
            ctx.translate(-canvas.width / 2 + panX, -canvas.height / 2 + panY);
            
            if (currentView === 'topology') {
                drawTopologyView(data);
            } else {
                drawHierarchyView(data);
            }
            
            ctx.restore();
        }
        
        function drawTopologyView(data) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Draw gateway/router at center
            drawNode(centerX, centerY, 40, 'üåê', 'Gateway\n172.79.89.1', '#667eea');
            
            // Draw switches in a circle around gateway with increased radius
            const switchRadius = 180;
            const switchAngleStep = (2 * Math.PI) / data.switches.length;
            
            data.switches.forEach((sw, i) => {
                const angle = i * switchAngleStep - Math.PI / 2; // Start from top
                const x = centerX + switchRadius * Math.cos(angle);
                const y = centerY + switchRadius * Math.sin(angle);
                
                const color = sw.connected ? '#ff9800' : '#f44336';
                drawNode(x, y, 35, 'üîÄ', sw.name, color);
                
                // Draw line to gateway
                drawConnection(centerX, centerY, x, y, sw.connected ? '#4CAF50' : '#f44336', 0.3);
                
                // Store position for host connections
                sw.x = x;
                sw.y = y;
            });
            
            // Calculate host positions in outer ring with more spacing
            const hostRadius = 380;
            const hostAngleStep = (2 * Math.PI) / data.hosts.length;
            
            data.hosts.forEach((host, hostIdx) => {
                const angle = hostIdx * hostAngleStep - Math.PI / 2;
                const x = centerX + hostRadius * Math.cos(angle);
                const y = centerY + hostRadius * Math.sin(angle);
                
                // Draw host
                drawNode(x, y, 45, 'üñ•Ô∏è', host.name, '#2196F3');
                host.x = x;
                host.y = y;
                
                // Calculate NIC positions around host in a semi-circle facing outward
                const nicCount = host.nics.length;
                const nicDistance = 90;
                
                host.nics.forEach((nicName, nicIdx) => {
                    const nic = data.nics.find(n => n.name === nicName && n.host === host.name);
                    if (nic) {
                        // Spread NICs in an arc facing away from center
                        const nicAngleOffset = ((nicIdx - (nicCount - 1) / 2) * 0.5);
                        const nicAngle = angle + nicAngleOffset;
                        const nicX = x + nicDistance * Math.cos(nicAngle);
                        const nicY = y + nicDistance * Math.sin(nicAngle);
                        
                        const nicColor = nic.status === 'up' ? '#4CAF50' : '#f44336';
                        drawNode(nicX, nicY, 22, 'üîå', '', nicColor, 1.0);
                        
                        // Draw label below NIC (not overlapping)
                        if (showLabels) {
                            ctx.font = '11px Arial';
                            ctx.fillStyle = '#333';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'top';
                            ctx.fillText(nic.name, nicX, nicY + 28);
                        }
                        
                        // Connect NIC to host with thin line
                        drawConnection(x, y, nicX, nicY, nicColor, 0.4, 1);
                        
                        // Connect NIC to switch with curved line if connected
                        if (nic.switch) {
                            const sw = data.switches.find(s => s.name === nic.switch);
                            if (sw && sw.x && sw.y) {
                                const portLabel = `Port ${nic.port}`;
                                drawCurvedConnection(nicX, nicY, sw.x, sw.y, nicColor, 0.5, 1.5, portLabel);
                            }
                        }
                        
                        nic.x = nicX;
                        nic.y = nicY;
                    }
                });
                
                // Draw containers on the opposite side (facing inward)
                const hostContainers = data.containers.filter(c => c.host_name === host.name);
                const containerDistance = 95;
                const containerCount = hostContainers.length;
                
                hostContainers.forEach((container, cIdx) => {
                    // Position containers on inner side of host (toward center)
                    const cAngleOffset = ((cIdx - (containerCount - 1) / 2) * 0.4);
                    const cAngle = angle + Math.PI + cAngleOffset; // Opposite side
                    const cX = x + containerDistance * Math.cos(cAngle);
                    const cY = y + containerDistance * Math.sin(cAngle);
                    
                    const cColor = container.status === 'running' ? '#00bcd4' : '#9e9e9e';
                    const healthColor = container.health_status === 'healthy' ? '#4CAF50' : '#ff9800';
                    
                    // Draw health ring
                    ctx.strokeStyle = healthColor;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(cX, cY, 21, 0, 2 * Math.PI);
                    ctx.stroke();
                    
                    drawNode(cX, cY, 18, 'üê≥', '', cColor, 1.0);
                    
                    // Draw label below container (not overlapping)
                    if (showLabels) {
                        ctx.font = '10px Arial';
                        ctx.fillStyle = '#333';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'top';
                        const shortName = container.container_name.length > 12 ? 
                            container.container_name.substring(0, 10) + '..' : 
                            container.container_name;
                        ctx.fillText(shortName, cX, cY + 26);
                    }
                    
                    // Connect container to host with thin line
                    drawConnection(x, y, cX, cY, cColor, 0.3, 1);
                    
                    // Store position for click detection
                    container.x = cX;
                    container.y = cY;
                });
            });
        }
        
        function drawHierarchyView(data) {
            const startY = 50;
            const levelHeight = 150;
            
            // Level 1: Gateway
            const centerX = canvas.width / 2;
            drawNode(centerX, startY, 40, 'üåê', 'Gateway', '#667eea');
            
            // Level 2: Switches
            const switchSpacing = canvas.width / (data.switches.length + 1);
            data.switches.forEach((sw, i) => {
                const x = switchSpacing * (i + 1);
                const y = startY + levelHeight;
                const color = sw.connected ? '#ff9800' : '#f44336';
                drawNode(x, y, 35, 'üîÄ', sw.name, color);
                drawConnection(centerX, startY, x, y, sw.connected ? '#4CAF50' : '#f44336');
                sw.x = x;
                sw.y = y;
            });
            
            // Level 3: Hosts and NICs
            let xOffset = 100;
            data.hosts.forEach(host => {
                const y = startY + levelHeight * 2;
                drawNode(xOffset, y, 40, 'üñ•Ô∏è', host.name, '#2196F3');
                host.x = xOffset;
                host.y = y;
                
                // NICs below host
                host.nics.forEach((nicName, idx) => {
                    const nic = data.nics.find(n => n.name === nicName && n.host === host.name);
                    if (nic) {
                        const nicX = xOffset + (idx - host.nics.length / 2) * 60;
                        const nicY = y + 80;
                        const nicColor = nic.status === 'up' ? '#4CAF50' : '#f44336';
                        drawNode(nicX, nicY, 20, 'üîå', nic.name, nicColor, 0.9);
                        drawConnection(xOffset, y, nicX, nicY, nicColor, 1);
                        
                        // Connect to switch
                        if (nic.switch) {
                            const sw = data.switches.find(s => s.name === nic.switch);
                            if (sw) {
                                drawConnection(nicX, nicY, sw.x, sw.y, nicColor, 1);
                            }
                        }
                    }
                });
                
                xOffset += 250;
            });
        }
        
        function drawNode(x, y, radius, icon, label, color, opacity = 1) {
            // Shadow
            ctx.shadowColor = 'rgba(0,0,0,0.2)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            // Circle
            ctx.globalAlpha = opacity;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, 2 * Math.PI);
            ctx.fill();
            
            // Border
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            ctx.shadowColor = 'transparent';
            
            // Icon
            ctx.font = `${radius * 0.8}px Arial`;
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(icon, x, y);
            
            // Label - only for gateway and switches (not NICs/containers)
            if (showLabels && label) {
                ctx.font = '12px Arial';
                ctx.fillStyle = '#333';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                const lines = label.split('\n');
                lines.forEach((line, i) => {
                    ctx.fillText(line, x, y + radius + 8 + i * 14);
                });
            }
            
            ctx.globalAlpha = 1;
        }
        
        function drawConnection(x1, y1, x2, y2, color, opacity = 1, lineWidth = 2) {
            ctx.globalAlpha = opacity;
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.globalAlpha = 1;
        }
        
        function drawCurvedConnection(x1, y1, x2, y2, color, opacity = 1, lineWidth = 2, label = '') {
            ctx.globalAlpha = opacity;
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            
            // Calculate control point for quadratic curve
            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2;
            
            // Offset control point perpendicular to the line
            const dx = x2 - x1;
            const dy = y2 - y1;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const curvature = dist * 0.15; // Curve intensity
            
            const controlX = midX - (dy / dist) * curvature;
            const controlY = midY + (dx / dist) * curvature;
            
            ctx.quadraticCurveTo(controlX, controlY, x2, y2);
            ctx.stroke();
            
            // Draw label at midpoint if enabled
            if (showConnectionLabels && label) {
                ctx.globalAlpha = 1;
                ctx.font = '10px Arial';
                ctx.fillStyle = '#fff';
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.strokeText(label, controlX, controlY);
                ctx.fillText(label, controlX, controlY);
            }
            
            ctx.globalAlpha = 1;
        }
        
        function togglePause() {
            isPaused = !isPaused;
            
            const pauseButton = document.getElementById('pauseButton');
            const pausedIndicator = document.getElementById('pausedIndicator');
            
            if (isPaused) {
                // Pause state
                pauseButton.textContent = '‚ñ∂ Resume Auto-Refresh';
                pauseButton.classList.add('paused');
                pausedIndicator.style.display = 'inline';
                
                // Clear the interval
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            } else {
                // Resume state
                pauseButton.textContent = '‚è∏ Pause Auto-Refresh';
                pauseButton.classList.remove('paused');
                pausedIndicator.style.display = 'none';
                
                // Refresh immediately
                const data = generateMockData();
                drawTopology(data);
                renderStatistics(data);
                renderHostTable(data);
                renderNICMapping(data);
                renderContainerTable(data);
                
                // Restart the interval
                autoRefreshInterval = setInterval(() => {
                    if (!isPaused) {
                        const data = generateMockData();
                        drawTopology(data);
                        renderStatistics(data);
                        renderHostTable(data);
                        renderNICMapping(data);
                        renderContainerTable(data);
                    }
                }, 30000);
            }
        }
        
        function toggleConnectionLabels() {
            showConnectionLabels = !showConnectionLabels;
            const data = generateMockData();
            drawTopology(data);
        }
        
        function zoomIn() {
            zoomLevel = Math.min(zoomLevel * 1.2, 3.0);
            const data = generateMockData();
            drawTopology(data);
        }
        
        function zoomOut() {
            zoomLevel = Math.max(zoomLevel / 1.2, 0.5);
            const data = generateMockData();
            drawTopology(data);
        }
        
        function setView(view) {
            currentView = view;
            document.getElementById('view-topology').classList.toggle('active', view === 'topology');
            document.getElementById('view-hierarchy').classList.toggle('active', view === 'hierarchy');
            
            const data = generateMockData();
            drawTopology(data);
        }
        
        function toggleLabels() {
            showLabels = !showLabels;
            const data = generateMockData();
            drawTopology(data);
        }
        
        function resetZoom() {
            zoomLevel = 1.0;
            panX = 0;
            panY = 0;
            const data = generateMockData();
            drawTopology(data);
        }
        
        function exportTopology() {
            const link = document.createElement('a');
            link.download = 'network-topology.png';
            link.href = canvas.toDataURL();
            link.click();
        }
        
        function showDetail(type, item, data) {
            const panel = document.getElementById('detailPanel');
            const title = document.getElementById('detailTitle');
            const content = document.getElementById('detailContent');
            
            let html = '';
            
            if (type === 'Host') {
                title.textContent = `üñ•Ô∏è Host: ${item.name}`;
                const hostContainers = data.containers.filter(c => c.host_name === item.name);
                
                html = `
                    <div class="detail-section">
                        <div class="detail-section-title">System Information</div>
                        <div class="detail-row">
                            <span class="detail-label">IP Address:</span>
                            <span class="detail-value">${item.ip}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">CPU Usage:</span>
                            <span class="detail-value" style="color: ${item.cpu > 80 ? '#f44336' : '#4CAF50'};">${item.cpu}%</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Memory:</span>
                            <span class="detail-value">${item.memory}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Containers:</span>
                            <span class="detail-value">${item.running_containers} / ${item.total_containers} Running</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Network Interfaces (${item.nics.length})</div>
                        ${data.nics.filter(n => n.host === item.name).map(n => `
                            <div class="detail-row">
                                <span class="detail-label">${n.name}:</span>
                                <span class="detail-value">
                                    ${n.ip || 'No IP'} 
                                    <span class="status-badge ${n.status}">${n.status}</span>
                                </span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Docker Containers (${hostContainers.length})</div>
                        ${hostContainers.map(c => `
                            <div style="background: #f8f9fa; padding: 10px; margin: 8px 0; border-radius: 4px;">
                                <div style="font-weight: bold; margin-bottom: 5px;">
                                    ${c.container_name}
                                    <span class="status-badge ${c.status}">${c.status}</span>
                                </div>
                                <div style="font-size: 0.85em; color: #666;">
                                    CPU: ${c.cpu_percent}% | Mem: ${c.memory_usage} (${c.memory_percent}%)<br>
                                    Uptime: ${c.uptime} | PIDs: ${c.pids}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (type === 'NIC') {
                title.textContent = `üîå NIC: ${item.name} (${item.host})`;
                
                html = `
                    <div class="detail-section">
                        <div class="detail-section-title">Interface Information</div>
                        <div class="detail-row">
                            <span class="detail-label">Host:</span>
                            <span class="detail-value">${item.host}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">IP Address:</span>
                            <span class="detail-value">${item.ip || 'Not Assigned'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">MAC Address:</span>
                            <span class="detail-value">${item.mac}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value">
                                <span class="status-badge ${item.status}">${item.status.toUpperCase()}</span>
                            </span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Speed:</span>
                            <span class="detail-value">${item.speed || 'N/A'}</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Switch Connection</div>
                        <div class="detail-row">
                            <span class="detail-label">Switch:</span>
                            <span class="detail-value">${item.switch || 'Not Connected'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Port:</span>
                            <span class="detail-value">${item.port || 'N/A'}</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Containers Using This NIC (${item.containers.length})</div>
                        ${item.containers.length > 0 ? 
                            item.containers.map(c => `<div class="detail-row"><span>${c}</span></div>`).join('') :
                            '<div style="text-align: center; color: #999; padding: 10px;">No containers using this interface</div>'
                        }
                    </div>
                `;
            } else if (type === 'Switch') {
                title.textContent = `üîÄ Switch: ${item.name}`;
                const connectedNICs = data.nics.filter(n => n.switch === item.name);
                
                html = `
                    <div class="detail-section">
                        <div class="detail-section-title">Switch Information</div>
                        <div class="detail-row">
                            <span class="detail-label">IP Address:</span>
                            <span class="detail-value">${item.ip}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Model:</span>
                            <span class="detail-value">${item.model}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Total Ports:</span>
                            <span class="detail-value">${item.ports}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Active Ports:</span>
                            <span class="detail-value">${item.activeports}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value">
                                <span class="status-badge ${item.connected ? 'up' : 'down'}">
                                    ${item.connected ? 'CONNECTED' : 'DISCONNECTED'}
                                </span>
                            </span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Connected NICs (${connectedNICs.length})</div>
                        ${connectedNICs.map(n => `
                            <div class="detail-row">
                                <span class="detail-label">Port ${n.port}:</span>
                                <span class="detail-value">${n.host} - ${n.name} (${n.ip})</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (type === 'Container') {
                title.textContent = `üê≥ Container: ${item.container_name}`;
                
                html = `
                    <div class="detail-section">
                        <div class="detail-section-title">Container Information</div>
                        <div class="detail-row">
                            <span class="detail-label">Container ID:</span>
                            <span class="detail-value" style="font-family: monospace; font-size: 0.85em;">${item.container_id}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Host:</span>
                            <span class="detail-value">${item.host_name}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value">
                                <span class="status-badge ${item.status}">${item.status.toUpperCase()}</span>
                            </span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Health:</span>
                            <span class="detail-value">
                                <span class="status-badge ${item.health_status === 'healthy' ? 'up' : 'down'}">
                                    ${item.health_status.toUpperCase()}
                                </span>
                            </span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Image:</span>
                            <span class="detail-value" style="font-size: 0.85em;">${item.image}</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Resource Usage</div>
                        <div class="detail-row">
                            <span class="detail-label">CPU:</span>
                            <span class="detail-value" style="color: ${item.cpu_percent > 50 ? '#f44336' : '#4CAF50'};">${item.cpu_percent}%</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Memory:</span>
                            <span class="detail-value">${item.memory_usage} / ${item.memory_limit} (${item.memory_percent}%)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">PIDs:</span>
                            <span class="detail-value">${item.pids}</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Network</div>
                        <div class="detail-row">
                            <span class="detail-label">Network Mode:</span>
                            <span class="detail-value">${item.network_mode}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ports:</span>
                            <span class="detail-value" style="font-size: 0.85em;">${item.ports}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">RX:</span>
                            <span class="detail-value">${item.network_rx}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">TX:</span>
                            <span class="detail-value">${item.network_tx}</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Disk I/O</div>
                        <div class="detail-row">
                            <span class="detail-label">Block Read:</span>
                            <span class="detail-value">${item.block_read}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Block Write:</span>
                            <span class="detail-value">${item.block_write}</span>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Runtime</div>
                        <div class="detail-row">
                            <span class="detail-label">Created:</span>
                            <span class="detail-value">${new Date(item.created).toLocaleString()}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Started:</span>
                            <span class="detail-value">${new Date(item.started).toLocaleString()}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Uptime:</span>
                            <span class="detail-value">${item.uptime}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Restart Count:</span>
                            <span class="detail-value">${item.restart_count}</span>
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = html;
            panel.classList.add('visible');
        }
        
        function closeDetailPanel() {
            document.getElementById('detailPanel').classList.remove('visible');
        }
        
        function renderStatistics(data) {
            document.getElementById('hostCount').textContent = data.hosts.length;
            document.getElementById('nicCount').textContent = data.nics.length;
            document.getElementById('switchCount').textContent = data.switches.length;
            document.getElementById('containerCount').textContent = data.containers.length;
        }
        
        function renderHostTable(data) {
            const tbody = document.getElementById('hostTable');
            
            tbody.innerHTML = data.hosts.map(host => {
                const containers = data.containers.filter(c => c.host_name === host.name);
                const runningCount = containers.filter(c => c.status === 'running').length;
                const healthyCount = containers.filter(c => c.health_status === 'healthy').length;
                
                return `
                    <tr style="cursor: pointer;" onclick='showDetail("Host", ${JSON.stringify(host).replace(/'/g, "&apos;")}, ${JSON.stringify(data).replace(/'/g, "&apos;")})'>
                        <td><strong>${host.name}</strong></td>
                        <td>${host.ip}</td>
                        <td>${host.nics.join(', ')}</td>
                        <td>${containers.length}</td>
                        <td>
                            <span class="status-badge running">${runningCount} Running</span>
                            ${containers.length - runningCount > 0 ? `<span class="status-badge stopped">${containers.length - runningCount} Stopped</span>` : ''}
                            ${healthyCount < containers.length ? `<br><small style="color: #ff9800;">${containers.length - healthyCount} degraded</small>` : ''}
                        </td>
                        <td style="color: ${parseFloat(host.cpu) > 80 ? '#f44336' : '#4CAF50'};">${host.cpu}%</td>
                        <td>${host.memory}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function renderNICMapping(data) {
            const tbody = document.getElementById('nicMappingTable');
            
            tbody.innerHTML = data.nics.map(nic => `
                <tr style="cursor: pointer;" onclick='showDetail("NIC", ${JSON.stringify(nic).replace(/'/g, "&apos;")}, ${JSON.stringify(data).replace(/'/g, "&apos;")})'>
                    <td><strong>${nic.name}</strong><br><small style="color: #999;">${nic.mac}</small></td>
                    <td>${nic.host}</td>
                    <td>${nic.ip || '<span style="color: #999;">Not Assigned</span>'}</td>
                    <td><span class="status-badge ${nic.status}">${nic.status.toUpperCase()}</span></td>
                    <td>${nic.switch || '<span style="color: #999;">Not Connected</span>'}</td>
                    <td>${nic.port || 'N/A'}</td>
                    <td>${nic.containers.length > 0 ? nic.containers.join(', ') : '<span style="color: #999;">None</span>'}</td>
                </tr>
            `).join('');
        }
        
        function renderContainerTable(data) {
            const tbody = document.getElementById('containerTable');
            
            tbody.innerHTML = data.containers.map(container => `
                <tr style="cursor: pointer;" onclick='showDetail("Container", ${JSON.stringify(container).replace(/'/g, "&apos;")}, ${JSON.stringify(data).replace(/'/g, "&apos;")})'>
                    <td><strong>${container.container_name}</strong></td>
                    <td>${container.host_name}</td>
                    <td>
                        <span class="status-badge ${container.status}">${container.status.toUpperCase()}</span>
                        <span class="status-badge ${container.health_status === 'healthy' ? 'up' : 'down'}" style="font-size: 0.75em;">${container.health_status}</span>
                    </td>
                    <td style="font-size: 0.85em;">${container.image}</td>
                    <td style="font-size: 0.8em;">${container.ports}</td>
                    <td>${container.network_mode}</td>
                    <td style="color: ${parseFloat(container.cpu_percent) > 50 ? '#f44336' : '#4CAF50'};">${container.cpu_percent}%</td>
                    <td>${container.memory_usage} (${container.memory_percent}%)</td>
                </tr>
            `).join('');
        }
        
        function initialize() {
            const data = generateMockData();
            
            drawTopology(data);
            renderStatistics(data);
            renderHostTable(data);
            renderNICMapping(data);
            renderContainerTable(data);
            
            // Canvas click handler
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Check if click is on a host node
                data.hosts.forEach(host => {
                    if (host.x && host.y) {
                        const dist = Math.sqrt((x - host.x) ** 2 + (y - host.y) ** 2);
                        if (dist < 40) {
                            showDetail('Host', host, data);
                        }
                    }
                });
                
                // Check if click is on a NIC node
                data.nics.forEach(nic => {
                    if (nic.x && nic.y) {
                        const dist = Math.sqrt((x - nic.x) ** 2 + (y - nic.y) ** 2);
                        if (dist < 20) {
                            showDetail('NIC', nic, data);
                        }
                    }
                });
                
                // Check if click is on a switch node
                data.switches.forEach(sw => {
                    if (sw.x && sw.y) {
                        const dist = Math.sqrt((x - sw.x) ** 2 + (y - sw.y) ** 2);
                        if (dist < 35) {
                            showDetail('Switch', sw, data);
                        }
                    }
                });
                
                // Check if click is on a container node
                data.containers.forEach(container => {
                    if (container.x && container.y) {
                        const dist = Math.sqrt((x - container.x) ** 2 + (y - container.y) ** 2);
                        if (dist < 18) {
                            showDetail('Container', container, data);
                        }
                    }
                });
            });
        }
        
        // Initialize on load
        window.addEventListener('load', initialize);
        window.addEventListener('resize', () => {
            const data = generateMockData();
            drawTopology(data);
        });
        
        // Auto-refresh every 30 seconds (stored in variable so it can be paused)
        autoRefreshInterval = setInterval(() => {
            if (!isPaused) {
                const data = generateMockData();
                drawTopology(data);
                renderStatistics(data);
                renderHostTable(data);
                renderNICMapping(data);
                renderContainerTable(data);
            }
        }, 30000);
    </script>
</body>
</html>
